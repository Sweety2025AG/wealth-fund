<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wealth Fund | Secure Access</title>
    <style>
        :root { --bg-dark: #000; --ash: #1a1a1a; --accent: #00d2ff; --success: #00ff88; --error: #ff4d4d; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-dark); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: #111; padding: 30px; border-radius: 20px; width: 100%; max-width: 380px; border: 1px solid #333; box-shadow: 0 0 40px rgba(0,210,255,0.1); position: relative; }
        
        .brand h1 { font-size: 28px; text-align: center; margin: 0; letter-spacing: 2px; }
        .brand p { text-align: center; color: var(--accent); font-size: 9px; letter-spacing: 4px; margin-bottom: 25px; }

        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #333; background: #000; color: white; box-sizing: border-box; outline: none; transition: 0.3s; }
        /* Error Highlighting */
        .field-error { border: 1px solid var(--error) !important; background: #200 !important; }
        .valid { border-color: var(--success) !important; }

        #sms-notif { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 350px; background: #fff; color: #000; padding: 15px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 1000; transition: 0.5s; display: flex; align-items: center; gap: 10px; border: 1px solid #ccc; }
        #sms-notif.show { top: 20px; }

        button { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.2s; text-transform: uppercase; }
        .btn-main { background: var(--accent); color: black; }
        .btn-otp { background: #333; color: white; font-size: 10px; flex: 1; border: 1px solid #444; }
        .btn-whatsapp { background: #25D366; }

        .pass-box { position: relative; }
        .eye { position: absolute; right: 12px; top: 22px; cursor: pointer; color: var(--accent); font-size: 9px; font-weight: bold; }
        
        .hidden { display: none; }
        .links { text-align: center; font-size: 12px; margin-top: 20px; }
        .links a { color: var(--accent); text-decoration: none; cursor: pointer; }
    </style>
</head>
<body>

<div id="sms-notif">
    <div style="font-size: 24px;">ðŸ’¬</div>
    <div><strong id="notif-title">Message</strong><br><span id="notif-body">OTP: 4492</span></div>
</div>

<div class="container" id="app-container">
    <div class="brand"><h1>Wealth Fund</h1><p>PREMIER MANAGEMENT</p></div>

    <div id="login-page">
        <input type="tel" id="login-phone" placeholder="Phone Number">
        <div class="pass-box">
            <input type="password" id="login-pass" placeholder="Password">
            <span class="eye" onclick="togglePass('login-pass')">VIEW</span>
        </div>
        <button class="btn-main" id="login-btn" onclick="processLogin()">Login</button>
        <div class="links">
            Don't have an account? <a onclick="showView('register')">Register</a>
        </div>
    </div>

    <div id="register-page" class="hidden">
        <input type="text" id="fname" class="reg-field" placeholder="First Name *">
        <input type="text" id="lname" class="reg-field" placeholder="Last Name *">
        <input type="tel" id="r-phone" class="reg-field" placeholder="Phone (10 Digits) *">
        
        <div style="display:flex; gap:8px;">
            <button class="btn-otp" onclick="sendFakeOTP('SMS')">SMS OTP</button>
            <button class="btn-otp btn-whatsapp" onclick="sendFakeOTP('WhatsApp')">WhatsApp OTP</button>
        </div>
        <input type="text" id="otp-in" class="reg-field" placeholder="Enter OTP *">

        <div class="pass-box">
            <input type="password" id="r-pass" class="reg-field" placeholder="Create Password *">
            <span class="eye" onclick="togglePass('r-pass')">VIEW</span>
        </div>

        <input type="text" id="empid" class="reg-field" placeholder="Employee ID *">
        <input type="text" id="refcode" class="reg-field" placeholder="Referral Code *">
        
        <button class="btn-main" id="reg-btn" onclick="processRegistration()">Complete Register</button>
        <div class="links"><a onclick="showView('login')">Back to Login</a></div>
    </div>

    <div id="dashboard-page" class="hidden" style="text-align: center;">
        <h2 style="margin-top: 20px;">Welcome, <span id="display-name" style="color:var(--accent)">User</span></h2>
        <div style="background: #222; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: left; font-size: 14px;">
            <p><strong>Status:</strong> Active Member âœ…</p>
            <p><strong>Employee ID:</strong> <span id="display-id"></span></p>
            <p><strong>Account Type:</strong> Wealth Premier</p>
        </div>
        <button class="btn-main" style="margin-top: 30px;" onclick="location.reload()">Secure Logout</button>
    </div>
</div>

<script>
    const dbUrl = 'https://api.sheetbest.com/sheets/98cdebcb-b77d-4c83-b622-7ab89fc1c460';

    function showView(view) {
        document.getElementById('login-page').classList.toggle('hidden', view !== 'login');
        document.getElementById('register-page').classList.toggle('hidden', view !== 'register');
        document.getElementById('dashboard-page').classList.toggle('hidden', view !== 'dashboard');
    }

    function togglePass(id) {
        const input = document.getElementById(id);
        input.type = input.type === "password" ? "text" : "password";
    }

    function sendFakeOTP(type) {
        const ph = document.getElementById('r-phone').value;
        if(ph.length < 10) { alert("Enter 10-digit phone first"); return; }
        const notif = document.getElementById('sms-notif');
        document.getElementById('notif-title').innerText = type + " Alert";
        document.getElementById('notif-body').innerText = `Wealth Fund OTP: ${Math.floor(1000 + Math.random() * 9000)}`;
        notif.classList.add('show');
        setTimeout(() => notif.classList.remove('show'), 5000);
    }

    async function processRegistration() {
        const fields = document.querySelectorAll('.reg-field');
        let hasEmpty = false;

        // 1. CLEAR PREVIOUS ERRORS & CHECK EMPTY
        fields.forEach(f => {
            f.classList.remove('field-error');
            if(f.value.trim() === "") {
                f.classList.add('field-error');
                hasEmpty = true;
            }
        });

        if(hasEmpty) {
            alert("STOP: All marked fields (*) are mandatory.");
            return; // EXIT FUNCTION HERE
        }

        // 2. PREPARE DATA
        const btn = document.getElementById('reg-btn');
        const userData = {
            fname: document.getElementById('fname').value,
            lname: document.getElementById('lname').value,
            phone: document.getElementById('r-phone').value,
            pass: document.getElementById('r-pass').value,
            empid: document.getElementById('empid').value,
            refcode: document.getElementById('refcode').value
        };

        btn.innerText = "Saving to Drive...";
        btn.disabled = true;

        try {
            await fetch(dbUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify([userData]),
            });
            alert("Registration Complete! Welcome to the team.");
            showView('login');
        } catch (e) {
            alert("Connection Error. Try again.");
        } finally {
            btn.innerText = "Complete Register";
            btn.disabled = false;
        }
    }

    async function processLogin() {
        const ph = document.getElementById('login-phone').value;
        const ps = document.getElementById('login-pass').value;
        const btn = document.getElementById('login-btn');

        if(!ph || !ps) { alert("Please enter login details."); return; }

        btn.innerText = "Authenticating...";
        btn.disabled = true;

        try {
            const res = await fetch(dbUrl);
            const users = await res.json();
            const found = users.find(u => u.phone.includes(ph) && u.pass === ps);

            if(found) {
                document.getElementById('display-name').innerText = found.fname;
                document.getElementById('display-id').innerText = found.empid;
                showView('dashboard');
            } else {
                alert("Credentials not found. Please register.");
            }
        } catch (e) {
            alert("Server Busy. Try again.");
        } finally {
            btn.innerText = "Login";
            btn.disabled = false;
        }
    }
</script>
</body>
</html>