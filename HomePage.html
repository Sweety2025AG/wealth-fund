<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wealth Fund | Secure Access</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
    <style>
        :root { --bg-dark: #000000; --ash: #1a1a1a; --panel: #2c2c2c; --accent: #00d2ff; --success: #00ff88; --error: #ff4d4d; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-dark); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: var(--panel); padding: 30px; border-radius: 20px; width: 100%; max-width: 400px; box-shadow: 0 0 30px rgba(0,210,255,0.15); border: 1px solid #333; }
        .brand h1 { font-size: 32px; text-align: center; margin: 0; color: white; font-weight: 800; }
        .brand p { text-align: center; color: var(--accent); font-size: 10px; letter-spacing: 4px; margin-bottom: 25px; }
        
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #444; background: #000; color: white; box-sizing: border-box; outline: none; }
        .red-mark { border: 2px solid var(--error) !important; }
        .green-mark { border: 2px solid var(--success) !important; }

        .checklist { font-size: 11px; margin: 10px 0; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; background: #222; padding: 10px; border-radius: 8px; }
        .check-item { color: #555; transition: 0.3s; }
        .check-item.valid { color: var(--success); font-weight: bold; }

        button { width: 100%; padding: 14px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; text-transform: uppercase; }
        .btn-main { background: var(--accent); color: black; }
        .btn-otp { background: #25D366; color: white; font-size: 11px; flex: 1; }
        
        .profile-btn { position: fixed; top: 20px; right: 20px; background: var(--accent); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: black; cursor: pointer; font-weight: bold; font-size: 20px; box-shadow: 0 0 15px var(--accent); }
        .hidden { display: none; }
        .iti { width: 100%; } /* Fix for country picker width */
    </style>
</head>
<body>

<div id="welcome-page" class="hidden" style="text-align:center;">
    <div class="profile-btn" onclick="document.getElementById('details').classList.toggle('hidden')">üë§</div>
    <h1 style="font-size: 3rem;">Welcome to <br><span style="color:var(--accent)">Wealth Fund</span></h1>
    <div id="details" class="hidden container" style="margin: 20px auto; text-align:left;">
        <h3 style="border-bottom: 1px solid var(--accent); padding-bottom: 5px;">Personal Details</h3>
        <p><strong>Name:</strong> <span id="p-name"></span></p>
        <p><strong>Phone:</strong> <span id="p-phone"></span></p>
        <p><strong>Emp ID:</strong> <span id="p-id"></span></p>
    </div>
</div>

<div class="container" id="auth-box">
    <div class="brand"><h1>Wealth Fund</h1><p>PREMIER MANAGEMENT</p></div>

    <div id="login-view">
        <input type="tel" id="l-phone" placeholder="Phone Number">
        <input type="password" id="l-pass" placeholder="Password">
        <button class="btn-main" onclick="login()">LOGIN</button>
        <p style="text-align:center; font-size:12px; margin-top: 20px;">
            <a href="#" style="color:var(--accent)">Forgot Password?</a> | 
            <a href="#" onclick="switchView('reg')" style="color:var(--accent)">Register</a>
        </p>
    </div>

    <div id="reg-view" class="hidden">
        <input type="text" id="fname" placeholder="First Name">
        <input type="text" id="lname" placeholder="Last Name">
        <input type="tel" id="r-phone" oninput="checkPhone(this)">
        
        <div style="display:flex; gap:10px; margin: 10px 0;">
            <button class="btn-otp" onclick="sendOTP('WhatsApp')">WhatsApp OTP</button>
            <button class="btn-otp" style="background:#444" onclick="sendOTP('SMS')">SMS OTP</button>
        </div>
        <input type="text" id="otp-in" placeholder="Enter OTP">

        <div style="position:relative">
            <input type="password" id="r-pass" placeholder="Password" oninput="checkPass(this)">
            <span style="position:absolute; right:10px; top:20px; font-size:9px; cursor:pointer; color:var(--accent)" onclick="toggleView()">SHOW</span>
        </div>

        <div class="checklist">
            <span id="c09" class="check-item">‚óè Numbers (0-9)</span>
            <span id="caz" class="check-item">‚óè Lowercase (a-z)</span>
            <span id="cAZ" class="check-item">‚óè Uppercase (A-Z)</span>
            <span id="csym" class="check-item">‚óè Symbols (!@#)</span>
        </div>

        <input type="text" id="empid" placeholder="Employee ID">
        <input type="text" placeholder="Referral Code">
        <button class="btn-main" onclick="register()">COMPLETE REGISTRATION</button>
        <button onclick="switchView('login')" style="background:transparent; color:white; font-size:11px; margin-top: 5px;">Back to Login</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<script>
    // Initialize Phone Input with India as default
    const phoneInput = document.querySelector("#r-phone");
    const iti = window.intlTelInput(phoneInput, {
        initialCountry: "in",
        separateDialCode: true,
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
    });

    const dbUrl = 'https://api.sheetbest.com/sheets/98cdebcb-b77d-4c83-b622-7ab89fc1c460';

    function switchView(v) {
        document.getElementById('login-view').classList.toggle('hidden', v === 'reg');
        document.getElementById('reg-view').classList.toggle('hidden', v === 'login');
    }

    function checkPhone(el) {
        // Validates based on international standards for selected country
        el.className = (iti.isValidNumber()) ? 'green-mark' : 'red-mark';
    }

    function checkPass(el) {
        const v = el.value;
        document.getElementById('c09').className = /[0-9]/.test(v) ? 'check-item valid' : 'check-item';
        document.getElementById('caz').className = /[a-z]/.test(v) ? 'check-item valid' : 'check-item';
        document.getElementById('cAZ').className = /[A-Z]/.test(v) ? 'check-item valid' : 'check-item';
        document.getElementById('csym').className = /[^A-Za-z0-9]/.test(v) ? 'check-item valid' : 'check-item';
        // Green if more than 8 chars and contains a number
        el.className = (v.length > 8 && /[0-9]/.test(v)) ? 'green-mark' : 'red-mark';
    }

    function toggleView() {
        let x = document.getElementById("r-pass");
        x.type = x.type === "password" ? "text" : "password";
    }

    function sendOTP(m) {
        if(!iti.isValidNumber()) return alert("Enter a valid phone number first");
        const ph = iti.getNumber();
        alert(`OTP sent to ${ph} via ${m}`);
        if(m === 'WhatsApp') {
            window.open(`https://wa.me/${ph.replace('+','')}/?text=Your%20Wealth%20Fund%20OTP%20is%201234`);
        }
    }

    async function register() {
        const data = {
            fname: document.getElementById('fname').value,
            lname: document.getElementById('lname').value,
            phone: iti.getNumber(),
            pass: document.getElementById('r-pass').value,
            empid: document.getElementById('empid').value
        };

        try {
            await fetch(dbUrl, {
                method: "POST",
                mode: "cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data),
            });
            alert("Registration Successful! Redirecting to login...");
            switchView('login');
        } catch (e) {
            alert("Error saving to Drive. Check your Sheet.best URL.");
        }
    }

    async function login() {
        const inputPhone = document.getElementById('l-phone').value;
        const inputPass = document.getElementById('l-pass').value;

        // Fetch all users from Google Sheets to verify
        const response = await fetch(dbUrl);
        const users = await response.json();

        const user = users.find(u => (u.phone.includes(inputPhone)) && u.pass === inputPass);

        if(user) {
            document.getElementById('auth-box').classList.add('hidden');
            document.getElementById('welcome-page').classList.remove('hidden');
            document.getElementById('p-name').innerText = user.fname + " " + user.lname;
            document.getElementById('p-phone').innerText = user.phone;
            document.getElementById('p-id').innerText = user.empid;
        } else {
            alert("Invalid credentials or user not found.");
        }
    }
</script>
</body>
</html>